  name: Next.js  Build and Deploy

  on:
    push:
      branches: [ "master" ]  # 触发分支

  jobs:
    build-and-deploy:
      runs-on: ubuntu-latest
      permissions:
        id-token: write
        contents: read
        pages: write
      steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Setup Node.js
          uses: actions/setup-node@v4
          with:
            node-version: '20'  # 推荐 LTS 版本

        - name: Install dependencies
          run: npm install

        - name: Build project
          run: npm run build  # 生成 out 目录

        - name: Validate build output
          run: |
            ls -R out/  # 检查构建产物是否存在 
            [ -f out/index.html  ] || exit 1 

        - name: Deploy to Pagesg
          uses: actions/upload-pages-artifact@v3
          with:
            path: 'out/'  # 上传 out 目录作为部署产物
            name: 'deploy-artifact'  # 显式命名
            retention-days: 1  # 建议添加产物保留时间

        - name: Deploy to GitHub Pages
          uses: actions/deploy-pages@v4
          with:
            artifact_name: 'deploy-artifact'  # 与上一步的产物名称一致